//=============================================================================
//
// スコア処理[score.cpp]
// Author : SHUGO KURODA
//
//=============================================================================

//*****************************************************************************
// インクルード
//*****************************************************************************
#include "main.h"
#include "object2D.h"
#include "renderer.h"
#include "manager.h"
#include "score.h"
#include "number.h"

//*****************************************************************************
// 静的メンバ変数
//*****************************************************************************
LPDIRECT3DTEXTURE9 CScore::m_pTexture = nullptr;

//=============================================================================
// コンストラクタ
//=============================================================================
CScore::CScore() :m_nScore(0)
{
}

//=============================================================================
// デストラクタ
//=============================================================================
CScore::~CScore()
{
}

//=============================================================================
// 生成
//=============================================================================
CScore *CScore::Create()
{
	CScore *pScore = new CScore;

	if (pScore != nullptr)
	{
		for (int nCntScore = 0; nCntScore < MAX_SCORE; nCntScore++)
		{
			// 数字ポリゴン生成
			pScore->pNumber[nCntScore] = new CNumber;

			if (pScore->pNumber[nCntScore] != nullptr)
			{
				// 位置設定
				pScore->pNumber[nCntScore]->SetPosition(D3DXVECTOR3(900.0f + (nCntScore * 20.0f), 50.0f, 0.0f));
				// サイズ設定
				pScore->pNumber[nCntScore]->SetSize(D3DXVECTOR2(30.0f, 30.0f));
				// 初期化
				pScore->pNumber[nCntScore]->Init();
			}
		}
	}

	return pScore;
}

//=============================================================================
// ポリゴンの初期化
//=============================================================================
HRESULT CScore::Init()
{
	CObject::SetObjType(CObject::OBJ_SCORE);

	return S_OK;
}

//=============================================================================
// 終了
//=============================================================================
void CScore::Uninit()
{
}

//=============================================================================
// 更新
//=============================================================================
void CScore::Update()
{
}

//=============================================================================
// 描画
//=============================================================================
void CScore::Draw()
{
}

//=============================================================================
// スコアの加算
//=============================================================================
void CScore::Add(const int& nScore)
{
	m_nScore += nScore;
	Set();
}

//=============================================================================
// スコアの設定
//=============================================================================
void CScore::Set()
{
	//各桁の数値を格納(pPostexU[桁ごとの数値])
	int aPosTexU[MAX_SCORE];

	aPosTexU[0] = (m_nScore % 100000000) / 10000000;
	aPosTexU[1] = (m_nScore % 10000000) / 1000000;
	aPosTexU[2] = (m_nScore % 1000000) / 100000;
	aPosTexU[3] = (m_nScore % 100000) / 10000;
	aPosTexU[4] = (m_nScore % 10000) / 1000;
	aPosTexU[5] = (m_nScore % 1000) / 100;
	aPosTexU[6] = (m_nScore % 100) / 10;
	aPosTexU[7] = m_nScore % 10;

	//テクスチャを更新する
	for (int nCntScore = 0; nCntScore < MAX_SCORE; nCntScore++)
	{
		pNumber[nCntScore]->SetAnimation(aPosTexU[nCntScore], 0, CNumber::DIVISION_U, CNumber::DIVISION_V);
	}
}